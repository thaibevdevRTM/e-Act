@using eActForm.Models
@using eActForm.BusinessLayer
@model eActForm.Models.Budget_Approve_Detail_Model.budgetForms
<style type="text/css">

	.my-bootbox-class .modal-dialog {
		width: 200px;
		font-size: 18px;
	}
</style>
<script>

      function callApproveList(actId) {
        $.ajax({
            type: 'POST',
            url:  '@Url.Action("myDocBudgetList", "BudgetMyDoc")',
            data: {
                actId: actId
            }
        }).done(function (response) {
			$("#divModalmyDocBudgetList").html(response)
			$('#modalmyDocBudgetList').modal('show');
        });
    }

    function resendApprove(actId) {
        $("#WaitDialog").show();
        $.ajax({
            type: 'POST',
            url:  '@Url.Action("resendApproveBudget", "Base")',
            data: {
                actId: actId
            }
        }).done(function (response) {
            $("#WaitDialog").hide();
            if (response.Success) {
                doMsgSuccess("ดำเนินการเรียบร้อยครับ")
            } else {
                doMsgFail(response.Message);
            }
        });
      }


</script>
<div class="row">

	<div class="col-md-12 col-xs-12">

	</div>
	<div class="col-md-12 col-xs-12">



		@*<a class="btn ink-reaction btn-danger fa fa-trash-o" href="#"></a>คือ Delete
			<a class="btn ink-reaction btn-info fa fa-edit" href="#"></a>คือ Edit*@
		<a class="btn ink-reaction btn-success fa fa-search" href="#"></a>คือ View PDF
		<a class="btn ink-reaction btn-dark fa fa-eye" href="#"></a>คือ History Approve
		<a class="btn ink-reaction btn-info fa fa-send-o" href="#"></a>คือ Resend Email

		<table id="datatable" class="table table-striped table-hover">
			<thead>
				<tr style="background-color:#2B5D95;color:#ffffff;">
					<th></th>
					<th>สถานะ</th>
					<th>วันที่เสนออนุมัติ</th>
					<th>เลขกิจกรรม</th>
					<th>ชื่อกิจกรรม</th>
					<th>ลูกค้า</th>
					<th>ประเภท</th>
					<th>จำนวนเงิน</th>
				</tr>
			</thead>
			<tbody>
				@if (Model.budgetFormLists.Count > 0)
				{
					foreach (var item in Model.budgetFormLists)
					{
						<tr class="gradeX">
							<td>

								@if (UtilsAppCode.Session.User.isAdmin || UtilsAppCode.Session.User.isSuperAdmin)
								{
									<a href="javascript:" onclick="return callPreviewApprove('@item.budgetApproveId','@item.statusId');">
										<i class="btn glyphicon glyphicon-retweet"></i>&nbsp;
									</a>
								}

								@Html.ActionLink(" ", "getPdfBudget", "BudgetViewer", new { budgetApproveId = item.budgetApproveId }, new { @class = "btn ink-reaction btn-success fa fa-search", target = "_blank" })
								<a onclick="callApproveList('@item.budgetApproveId');">
									<i class="btn ink-reaction btn-dark fa fa-eye"></i>
								</a>

								@if (item.statusId == "2")
								{
									<a onclick="resendApprove('@item.budgetApproveId');">
										<i class="btn ink-reaction btn-info fa fa-send-o"></i>
									</a>
								}

							</td>
							<td>@item.statusName</td>
							<td>@{var date = item.documentDate == null ? "" : item.documentDate.Value.ToString("dd/MM/yyyy");} @date </td>
							<td>@item.activityNo</td>
							<td>@item.activityName</td>
							<td>@item.cusShortName</td>
							<td>@item.productCategory</td>
							<td align="right">
								@if (@item.totalInvoiceApproveBath != 0)
								{
									string result = String.Format("{0:n2}", @item.totalInvoiceApproveBath);
									@result.ToString();
								}

							</td>
						</tr>
					}
				}
			</tbody>
		</table>

	</div>
</div>
<div class="modal fade" id="modalmyDocBudgetList" role="dialog" style="display:none">
	<div id="divModalmyDocBudgetList">
	</div>
</div>
<script>
	$(document).ready(function () {
		$('#datatable').DataTable({
			"columnDefs": [
				{ "orderable": false, "targets": 0 }
			],
			"dom": 'lCfrtip',
			"order": [],
			"language": {
				"lengthMenu": '_MENU_ entries per page',
				"search": '<i class="fa fa-search"></i>',
				"paginate": {
					"previous": '<i class="fa fa-angle-left"></i>',
					"next": '<i class="fa fa-angle-right"></i>'
				}
			}
		});

	});
	function waitpopup() {
		$("#WaitDialog").show();
	}

	 function callPreviewApprove(actId, statusId) {
        $.ajax({
            type: 'POST',
            url: '@Url.Action("previewApproveBudget", "BudgetApprove")',
            data: {
				budgetApproveId: actId
            }
        }).done(function (htmlResponse) {
            genPdf(actId, statusId, htmlResponse);
        });
    }
    function genPdf(actId, statusId, htmlResponse) {
        $.ajax({
            url: '@Url.Action("genPdfApprove", "BudgetMyDoc")',
            data: {
                GridHtml: htmlResponse,
                statusId: statusId,
				budgetApproveId: actId,
            },
            dataType: "json",
            type: 'POST',
        }).done(function (response) {
            doMsgSuccess("ดำเนินการเรียบร้อยครับ");
        });
	}

</script>
