@model eActForm.Models.Budget_Activity_Model
@{
	Layout = null;
	//decimal? totalActCost = 0;
}


<script>

	   function submitInvoice() {
		   $.ajax({
            url: '@Url.Action("submitInvoice", "Budget")',
				data: {
				budgetInvoiceModel: ObjModel,
				Id: $("#hd_invoiceId").val(),
				activityId: $("#hd_activityId").val(),
				activityNo: $("#hd_activityNo").val(),
				productId: $("#hd_productId").val(),
				activityOfEstimateId: $("#hd_activityOfEstimateId").val(),
				//invoiceId: $("#hd_invoiceId").val(),
				invoiceNo: $("#txt_invoice_no").val(),
				invTotalBath: $("#txt_invoice_baht").val(),
				actionDate: $("#txt_date_action").val(),
            },
            dataType: "json",
			type: 'POST',
			success: function (response) {
				$('#myModal').modal('hide');
				console.log(response.success);

				@*var var_activityId = document.getElementById("hd_activityId").value;
				var url = "@Url.Action("EditForm", "Budget")" + "?activityId=" + var_activityId ;
				window.location.href = url;*@

				window.location.reload()
			}
		   })


	   @*bootbox.confirm("ยืนยัน บันทึกข้อมูล!", function (result) {
		   if (result == true) {
			$.ajax({
            url: '@Url.Action("submitInvoice", "Budget")',
				data: {
				budgetInvoiceModel: ObjModel,
				Id: $("#hd_activityId").val(),
				activityId: $("#hd_activityId").val(),
				activityNo: $("#hd_activityNo").val(),
				productId: $("#hd_productId").val(),
				invoiceNo: $("#txt_invoice_no").val(),
				invTotalBath: $("#txt_invoice_baht").val(),
				actionDate: $("#txt_date_action").val(),
            },
            dataType: "json",
            type: 'POST',
			}).done
			(
				function (response)
				{

					$.ajax({
					url: '@Url.Action("EditForm", "Budget")',
					data: {
						activityId: $("#hd_activityId").val(),
						//productId: $("#hd_productId").val(),
					},
					dataType: "json",
					type: 'POST',
					})
					$('#myModal').modal('hide');
					console.log('success');
				}
			);
		   } else {


		   }
         });*@
	}


</script>

<input type="hidden" id="hd_activity">
@Html.HiddenFor(x => x.Budget_Activity_Product_list.ElementAt(0).act_activityId, new { @id = "hd_activityId" })
@Html.HiddenFor(x => x.Budget_Activity_Product_list.ElementAt(0).act_activityNo, new { @id = "hd_activityNo" })
@Html.HiddenFor(x => x.Budget_Activity_Product_list.ElementAt(0).prd_productId, new { @id = "hd_productId" })
@Html.HiddenFor(x => x.Budget_Activity_Product_list.ElementAt(0).invoiceId, new { @id = "hd_invoiceId" })
@Html.HiddenFor(x => x.Budget_Activity_Product_list.ElementAt(0).activityOfEstimateId, new { @id = "hd_activityOfEstimateId" })
<style>
	.font14 {
		font-size: 14px;
	}
</style>

<div class="modal-dialog modal-lg" style="width:90%;">
	<!-- Modal content-->
	<div class="modal-content">
		<div class="modal-header">
			<div style=""></div>
			<button type="button" class="close" data-dismiss="modal">&times;</button>
		</div>
		<div class="modal-body">
			<div id="Grid" style="width:97%; margin-left:20px;">
				<style>
					.cssborderbottom {
						border-bottom-width: 1px;
						border-bottom-style: solid;
						border-bottom-color: gray;
					}
				</style>

				<div>
					<div style="text-align:left;">
						<h4>
							เลขที่กิจกรรมส่งเสริมการขาย :
							@if (Model.Budget_Activity_Product_list.ElementAt(0).act_activityNo != null)
							{
								@Html.DisplayFor(item => Model.Budget_Activity_Product_list.ElementAt(0).act_activityNo)
							}
						</h4>
					</div>
					@if (Model.Budget_Activity_Product_list.ElementAt(0).invoiceId != "")
					{
						<div style="text-align:left;">
							<h4>
								เลขที่ใบแจ้งหนี้ :
								@Html.DisplayFor(item => Model.Budget_Activity_Product_list.ElementAt(0).invoiceNo)
							</h4>
						</div>
					}
				</div>

				<div>
					<table style="border-bottom-width:1px; border-bottom-style: solid; border-bottom-color: gray; width:100%;"><tr><td>&nbsp;</td></tr></table>
				</div>

				<div style="margin-top:5px; width:100%;" class="font-weight-bold">
					<h5><strong>รายละเอียดค่าใช้จ่าย (Cost)</strong></h5>
				</div>

				<div>
					<table class="tablethin" style="width:100%; text-align:center;" border="1" cellpadding="0" cellspacing="0">
						<tr>
							<td rowspan="2" width="30%" class="font14">กลุ่มสินค้า/ชื่อสินค้า/Remark</td>
							<td colspan="5" class="font14">ค่าใช้จ่ายจริง (Estimate)</td>
						</tr>
						<tr>
							<td width="10%" class="font14">จำนวนเงินที่ตั้ง</td>
							<td width="10%" class="font14">เลขที่ใบแจ้งหนี้</td>
							<td width="10%" class="font14">จำนวนเงินจ่าย</td>
							<td width="10%" class="font14">วันที่ทำกิจกรรม</td>
							<td width="10%" class="font14">สถานะ</td>
						</tr>

						<tr>
							<td width="10%" class="font14" style="text-align:left;">
								@if (Model.Budget_Activity_Product_list != null)
								{
									@Html.DisplayFor(item => Model.Budget_Activity_Product_list.ElementAt(0).prd_productDetail)

								}
							</td>
							<td width="15%" class="font14" style="text-align:right;">
								@*@if (Model.Budget_Activity_Product_list != null)*@


								@if (Model.Budget_Activity_Product_list.ElementAt(0).invoiceId != "")
								{
									@Html.DisplayFor(item => Model.Budget_Activity_Product_list.ElementAt(Model.Budget_Activity_Product_list.Count - 1).productStandBath)
								}
								else
								{
									@Html.DisplayFor(item => Model.Budget_Activity_Product_list.ElementAt(Model.Budget_Activity_Product_list.Count - 1).productBalanceBath)
								}

								&nbsp;
							</td>
							@if (Model.Budget_Activity_Product_list.ElementAt(0).invoiceId != "")
							{
								<td width="10%"><input class="form-control textboxcss font14" style="text-align:center;" id="txt_invoice_no" value="@Html.DisplayFor(item => item.Budget_Activity_Product_list.ElementAt(0).invoiceNo)"></td>
								<td width="10%"><input class="form-control textboxcss font14" style="text-align:right;" id="txt_invoice_baht" value="@Html.DisplayFor(item => item.Budget_Activity_Product_list.ElementAt(0).invTotalBath)"></td>
								<td width="10%"><input class="form-control textboxcss font14" style="text-align:center;" id="txt_date_action" value="@Html.DisplayFor(item => item.Budget_Activity_Product_list.ElementAt(0).invActionDate)"></td>
								<td width="10%">
									@Html.DropDownListFor(item => item.Budget_Activity_Ststus_list, new SelectList(Model.Budget_Activity_Ststus_list, "id", "nameTH", 1), "Please Select", new { @class = "form-control textboxcss", id = "ddlStatusEdit" })
								</td>
							}
							else
							{
								<td width="10%"><input class="form-control textboxcss font14" style="text-align:center;" id="txt_invoice_no"></td>
								<td width="10%"><input class="form-control textboxcss font14" style="text-align:right;" id="txt_invoice_baht"></td>
								<td width="10%"><input class="form-control textboxcss font14" style="text-align:center;" id="txt_date_action"></td>
								<td width="10%">
									@Html.DropDownListFor(item => item.Budget_Activity_Ststus_list, new SelectList(Model.Budget_Activity_Ststus_list, "id", "nameTH", 2), "Please Select", new { @class = "form-control textboxcss", id = "ddlStatusNew" })
								</td>
							}

						</tr>

					</table>
				</div>

			</div>
		</div>
		<div class="modal-footer">
			<div>
				<p class="d-flex justify-content-center">
					<button type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa fa-reply fa-fw"></i>&nbsp;Close</button>
					<button type="button" class="btn ink-reaction btn-success" onclick="submitInvoice();"><i class="fa fa fa-check fa-fw"></i>&nbsp;Submit</button>
				</p>
			</div>

		</div>
	</div>
</div>


<script type="text/javascript">
	$(document).ready(function () {

		//$('.field-date').datepicker({ autoclose: true, todayHighlight: true, format: "dd/mm/yyyy" });
		ObjModel = {};
		//onchangeCustomer();
		//onchangeCate();

		//var dp = $('#txt_date_action').datepicker().data('datepicker');
		//dp.selectDate(new Date());

	});

	var today = new Date();
	var dd = String(today.getDate()).padStart(2, '0');
	var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
	var yyyy = today.getFullYear();

	today = dd + '-' + mm + '-' + yyyy;
	document.getElementById("txt_date_action").defaultValue = today;


	$.datetimepicker.setLocale('th');
	var thaiYear = function (ct) {
		var leap = 3;
		var dayWeek = ["พฤ.", "ศ.", "ส.", "อา.", "จ.", "อ.", "พ."];
		if (ct) {
			var yearL = new Date(ct).getFullYear();
			leap = (((yearL % 4 == 0) && (yearL % 100 != 0)) || (yearL % 400 == 0)) ? 2 : 3;
			if (leap == 2) {
				dayWeek = ["ศ.", "ส.", "อา.", "จ.", "อ.", "พ.", "พฤ."];
			}
		}
		this.setOptions({
			i18n: { th: { dayOfWeek: dayWeek } }, dayOfWeekStart: leap,
		})
	};

	$("#txt_date_action").datetimepicker({
		timepicker: false,
		format: 'd-m-Y',  // กำหนดรูปแบบวันที่ ที่ใช้ เป็น 00-00-0000
		lang: 'th',  // แสดงภาษาไทย
		onChangeMonth: thaiYear,
		onShow: thaiYear,
		//yearOffset: 543,  // ใช้ปี พ.ศ. บวก 543 เพิ่มเข้าไปในปี ค.ศ
		closeOnDateSelect: true,
	}
	);
</script>