@model eActForm.Models.Activity_TBMMKT_Model
@using eActForm.BusinessLayer;
@using System.Configuration;

<table style="width: 100%;border-style: solid;border-width: 0px 0px 0px 0px; border-collapse: collapse;">
    <tr style="">
        <td>
            <div id="divHeaderDetails" runat="server" style="width: 100%;">
                <table style="width: 100%;" id="tabelHeaderDetails" runat="server">
                    <tr>
                        <td>
                            <div class="form-group">

                                <label class="control-label col-md-2 col-xs-12">
                                    เรื่อง
                                </label>

                                <div class="col-md-4 col-xs-12">
                                    <div class="row">
                                        @Html.TextAreaFor(x => x.activityFormTBMMKT.activityName, new { @class = "form-control textboxcss", @id = "txtActivityName", style = "", @rows = "1" })
                                    </div>
                                </div>

                                <label class="control-label col-md-2 col-xs-12">
                                    เอกสารเลขที่ :
                                </label>

                                <div class="col-md-4 col-xs-12">
                                    <div class="row">
                                        @Html.TextBoxFor(x => x.activityFormModel.activityNo, new { @class = "form-control textboxcss", @id = "txtActivityNo", @readonly = "readonly" })
                                    </div>
                                </div>

                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-2 col-xs-12">
                                    ปีงบประมาณ :
                                </label>
                                <div class="col-md-4 col-xs-12">
                                    <div class="row">
                                        @Html.DropDownListFor(x => x.activityFormTBMMKT.listFiscalYearModelSelect, new SelectList(Model.listFiscalYearModel, "UseYear", "UseYear", ""), "", new
                                   {
                                       @class = "form-control selectpicker",
                                       id = "ddlFiscalYear"
                                   })
                                        <script>
                                            $('#ddlFiscalYear').change(function () {
                                                bindDropdownEO();
                                            });
                                            function bindDropdownEO() {
                                                var valproductBrandId = '';
                                                var valchannelId = '';
                        if ($('#ddlChannelOrBrand').val() =="Brand") {
                            valproductBrandId = $('#ddlBrand').val();
                            valchannelId = '';
                        } else {
                            valproductBrandId = '';
                            valchannelId = $('#ddlChannel').val();
                                                }

                        var dataToBeSend = {
                            fiscalYear: $('#ddlFiscalYear').val()
                            , master_type_form_id: "@Model.activityFormTBMMKT.master_type_form_id"
                            , productBrandId: valproductBrandId
                            , channelId: valchannelId
                        };

                                                var nameDDl = "#ddl_EO_PV";
                                                var ddl_EO_PV = $(nameDDl);
                        $.ajax('@Url.Action("GetDataEOPaymentVoucher", "GetDataMainForm")',
                            {
                                contentType: "application/json; charset=utf-8",
                                data: JSON.stringify(dataToBeSend),
                                dataType: 'json',
                                type: "POST",
                                success: function (response) {
                                    if (response.Data.tbToAjax.length > 0) {
                                        var data = [];
                                        $(nameDDl + " option[value !='']").remove();
                                        $.each(response.Data.tbToAjax, function () {
                                            data.push({ label: this['EO'], value: this['activityId'], selected: false });
                                        });
                                        $(nameDDl).multiselect('dataprovider', data);
                                    }
                                    else {

                                    }
                                },
                                error: function (data) {
                                    alert("Error GetDataEOPaymentVoucher.");
                                }
                            });
                                            }

                                        </script>
                                    </div>
                                </div>

                                <label class="control-label col-md-2 col-xs-12">
                                    งบประมาณเลขที่EO:
                                </label>

                                <div class="col-md-4 col-xs-12">
                                    <div class="row">
                                        <style>
                                            td div span {
                                                line-height: 0px;
                                            }

                                            .multiselect-container {
                                                width: 100% !important;
                                            }
                                        </style>
                                        @Html.DropDownList("activityFormTBMMKT.list_1_multi_select", new SelectList(Model.listGetDataEO,
                                            "activityId", "EO"),
                                            new
                                            {
                                                @class = "form-control selectpicker",
                                                id = "ddl_EO_PV",
                                                multiple = "multiple"
                                            })
                                        @*@Html.DropDownList("activityFormTBMMKT.list_1_multi_select", new SelectList(Model.listFiscalYearModel,
                                            "UseYear", "UseYear"),
                                            new
                                            {
                                                @class = "form-control selectpicker",
                                                id = "ddl_EO_PV",
                                                multiple = "multiple"
                                            })*@
                                        <script>
                                            $(document).ready(function () {
                                                $('#ddl_EO_PV').multiselect({
                                                numberDisplayed: 2,
                                                enableFiltering: true,
                                                nonSelectedText: '',
                                                buttonWidth: '100%',
                                                onChange: function (option, checked) {
                                                    //clearDataInTable();//ต้องเคลียร์กันไปเลือกMatในหัวข้อ ขอเบิก อื่นๆแล้วกลับมาแก้ไข หัวข้อเบิกใหม่ที่ไม่มี Mat ดังกล่าว
                                                    if ($("#ddl_EO_PV").val() != "") {
                                                        //var valueInStock = "4C059B00-6350-4E46-82E0-98E28807C697";
                                                        //var valueProduct = "AD1A2D99-04A5-43B6-988A-109B03614358";
                                                        //var valuePOS = "4F1909E0-A047-4DA3-8C68-4C2780120E71";
                                                        //var valuePREMIUM = "F890856A-13EE-4C1D-8453-6D824481BCDD";

                                                        //if ($('#ddlin_or_out_stock').val() == valueInStock) {
                                                        //    if (option.val() == valuePREMIUM && checked === true) {
                                                        //        var values = [];
                                                        //        values.push(valueProduct);
                                                        //        values.push(valuePOS);
                                                        //        $('#ddlproduct_pos_premium').multiselect('deselect', values, true);
                                                        //    } else if ((option.val() == valueProduct && checked === true) || (option.val() == valuePOS && checked === true)) {
                                                        //        $('#ddlproduct_pos_premium').multiselect('deselect', valuePREMIUM, true);
                                                        //    }
                                                        //    $('#ddlproduct_pos_premium option').each(function () {
                                                        //        //ไว้เล่นวนลูปค่า
                                                        //        //if ($(this).val() == option.val()) {
                                                        //        //    alert($(this).val());
                                                        //        //}
                                                        //    });
                                                        //}
                                                    }
                                                },
                                            });
                                            @*if ($("#ddlin_or_out_stock").val() == "") {
                                                $('#ddlproduct_pos_premium').multiselect('disable');
                                            } else
                                            {
                                                var valuesSelectChoiceFromDb = [];
                                                @if (Model.activityFormTBMMKT.list_1_multi_select != null)
                                                {
                                                    foreach (var itemArray in Model.activityFormTBMMKT.list_1_multi_select)
                                                    {
                                                    @:valuesSelectChoiceFromDb.push("@itemArray");
                                                    }
                                                }
                                                $("#ddlproduct_pos_premium").multiselect('select', valuesSelectChoiceFromDb);
                                            }*@
                                                $(".caret").css('float', 'right');//ทำให้ caret ไปอยู่ขวาสุดของ Dropdown Multiselect ห้ามลบ
                                                $(".caret").css('margin', '8px 0');//ทำให้ caret ไปอยู่ขวาสุดของ Dropdown Multiselect ห้ามลบ
                                        });
                                        </script>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>

            </div>
        </td>
    </tr>
</table>
