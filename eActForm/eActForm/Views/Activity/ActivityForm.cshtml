@using eActForm.Models
@using eActForm.BusinessLayer
@using System.Configuration;
@model eActForm.Models.Activity_Model

@{
    /**/

    ViewBag.Title = "Home Page";
    var mode = Request["mode"] == null ? "" : Request["mode"];
}

<script src="~/Scripts/dropzone/dropzone.min.js"></script>
<link href="~/Scripts/dropzone/dropzone.min.css" rel="stylesheet" />


<style type="text/css">

    .font8 {
        font-size: 8px;
    }

    .font10 {
        font-size: 10px;
    }

    .textLeft {
        text-align: left;
    }

    .inner {
        display: inline-block;
    }

    #outer {
        width: 100%;
        text-align: center;
    }
</style>



<div class="alert alert-success" role="alert">
    <h4 class="alert-heading">แบบฟอร์มกิจกรรมส่งเสริมการขาย (Activity Form)</h4>
    <p></p>
</div>


<div class="row">
    <form class="form-horizontal form-label-left" id="demo-form2" novalidate="" data-parsley-validate="">
        <div class="form-group">
            <div class="col-md-6 col-xs-12"></div>
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtActivityNo">
                        Act No.
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @Html.TextBoxFor(x => x.activityFormModel.activityNo, new { @class = "form-control textboxcss", @id = "txtActivityNo", @readonly = "readonly" })
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-6 col-xs-12"></div>
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtdateDoc">
                        Document Date<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @if (Model.activityFormModel.documentDate.ToString() != "")
                        {
                            @*@Html.TextBoxFor(x => x.activityFormModel.documentDate, "{0:dd-MM-yyyy}", new { @class = "form-control textboxcss", @id = "txtdateDoc", @readonly = true, autocomplete = "off" })*@
                            @Html.TextBox("activityFormModel.documentDateStr", DocumentsAppCode.convertDateTHToShowCultureDateEN(Model.activityFormModel.documentDate, ConfigurationManager.AppSettings["formatDateUse"]), new { @class = "form-control textboxcss", @readonly = true, @id = "txtdateDoc", autocomplete = "off" })
                        }
                        else
                        {
                            @*@Html.TextBoxFor(x => x.activityFormModel.documentDate, "{0:dd-MM-yyyy}", new { @class = "form-control textboxcss", @id = "txtdateDoc", @Value = @DateTime.Now.ToString("dd-MM-yyyy"), @readonly = true, autocomplete = "off" })*@
                            @Html.TextBox("activityFormModel.documentDateStr", DocumentsAppCode.convertDateTHToShowCultureDateEN(Model.activityFormModel.documentDate, ConfigurationManager.AppSettings["formatDateUse"]),
                           new { @class = "form-control textboxcss", @id = "txtdateDoc", @Value = DocumentsAppCode.convertDateTHToShowCultureDateEN(@DateTime.Now, ConfigurationManager.AppSettings["formatDateUse"]), @readonly = true, autocomplete = "off" })

                        }
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-6 col-xs-12"></div>
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtReferenceRefActNo">
                        Referene ActNo.
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div id="divReference">
                            @Html.TextBoxFor(x => x.activityFormModel.referenceActNo, new { @class = "form-control textboxcss", @id = "txtReferenceActNo", autocomplete = "off", @readonly = "readonly" })
                            @Html.HiddenFor(x => x.activityFormModel.referenceActNo, new { @id = "hdReferenceActNo" })
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-6 col-xs-12"></div>
            <div class="col-md-6 col-xs-12">

                <div class="row">

                    @if (Model.activityFormModel.typeForm == Activity_Model.activityType.MT.ToString())
                    {
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtReference">
                            Customer Format
                        </label>
                    }
                    else
                    {
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtReference">
                            Reference
                        </label>
                    }

                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div id="divReference">
                            @Html.TextBoxFor(x => x.activityFormModel.reference, new { @class = "form-control textboxcss", @id = "txtReference", autocomplete = "off" })
                        </div>
                        <div id="divRadioRef" class="radioRef">
                        </div>
                    </div>
                </div>


            </div>
        </div>

        <div class="form-group" id="divRegion">
            <div class="col-md-6 col-xs-12"></div>
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="ddlRegion">
                        Region<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @Html.DropDownListFor(x => x.activityFormModel.regionId, new SelectList(Model.regionGroupList, "id", "descTh", 0), "Please Select", new
                   {
                       @class = "form-control textboxcss",
                       id = "ddlRegion"
                   })
                    </div>
                </div>
            </div>
        </div>




        <div class="form-group">
            <div class="col-md-6 col-xs-12"></div>
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="ddlCustomer">
                        Customer Name<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">

                        @Html.TextBoxFor(x => x.activityFormModel.customerName, new { @class = "form-control textboxcss", @id = "txtCustomerName", @name = "txtCustomerName" })
                        @Html.HiddenFor(x => x.activityFormModel.customerId, new { id = "customerId" })


                        @Html.DropDownListFor(x => x.activityFormModel.customerId, new SelectList(Model.customerslist, "id", "cusNameTH", 0), "Please Select", new
                   {
                       @class = "form-control textboxcss",
                       onchange = "onchangeCustomer();",
                       id = "ddlCustomer"
                   })



                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="col-md-6 col-xs-12">
                    <div class="row">
                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtActivityName">
                            ชื่อกิจกรรม <span class="required">*</span>
                        </label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            @Html.TextBoxFor(x => x.activityFormModel.activityName, new { @class = "form-control textboxcss", @id = "txtActivityName", autocomplete = "off" })
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xs-12">
                    <div class="row">

                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="ddlProductCate">
                            Product category<span class="required">*</span>
                        </label>
                        <div class="col-md-9 col-sm-9 col-xs-12">
                            @Html.DropDownListFor(x => x.activityFormModel.productCateId, new SelectList(Model.productcatelist, "id", "cateName", 0), "Please Select", new
                       {
                           @class = "form-control textboxcss",
                           required = "required",
                           onchange = "onchangeCate();",
                           id = "ddlProductCate"
                       })
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="ddlTheme">
                        ประเภทกิจกรรม<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @Html.DropDownListFor(x => x.activityFormModel.theme, new SelectList(Model.activityGroupList, "id", "activitySales", 0), "Please Select", new
                         {
                             @class = "form-control textboxcss",
                             id = "ddlTheme",
                             onchange = "onchangeActivity()"
                         })
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="productGroup">
                        Product Group<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @Html.DropDownListFor(model => model.activityFormModel.productGroupId, new SelectList(Model.productGroupList, "id", "groupName", 0), "Please Select", new { @class = "form-control textboxcss", required = "required", id = "ddlProductGrp" })
                    </div>
                </div>
            </div>
        </div>


        <div id="divSubAct" class="col-md-12 col-xs-12" style="display:none">
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">
                        เพื่อกิจกรรม<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @Html.DropDownListFor(x => x.activityFormModel.subActivity, new SelectList(Model.activityGroupFilterList, "id", "activityAccount", 0), "Please Select", new
                        {
                        @class = "form-control textboxcss",
                        id = "ddlSubActivity"
                        })
                    </div>
                </div>
            </div>
        </div>


        <div class="form-group">
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtObjective">
                        วัตถุประสงค์<span class="required">*</span>
                    </label>

                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @Html.TextBoxFor(x => x.activityFormModel.objective, new { @class = "form-control textboxcss", @id = "txtObjective", autocomplete = "off" })
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-xs-12">
                <div class="row">

                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="productGroup">
                        Product Brand<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        @Html.DropDownListFor(model => model.activityFormModel.productBrandId, new SelectList(Model.productBrandList, "id", "brandName"), "- เลือกประเภท -", new { @class = "form-control textboxcss", required = "required", id = "ddlProductBrand" })
                    </div>

                </div>
            </div>
        </div>
        <div class="form-group">
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="col-md-3 col-sm-3 col-xs-12 control-label">
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="radio">
                            <label>
                                @Html.RadioButtonFor(m => m.activityFormModel.trade, "term", new { @id = "rdbterm" }) รายการส่งเสริมการขาย (Trade Term)
                            </label>
                        </div>
                        <div class="radio">
                            <label>
                                @Html.RadioButtonFor(m => m.activityFormModel.trade, "outterm", new { @id = "rdbOutterm" }) รายการส่งเสริมการขาย (นอก Trade Term)
                            </label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12">
                        @Html.CheckBoxFor(m => m.activityFormModel.chkAddIO, new { id = "chkAddIO", onchange = "OnChangeChkIO(this)" }) IO
                    </label>
                    <div id="divIO" class="col-md-9 col-sm-9 col-xs-12" style="margin-left:-10px">
                        <div class="col-md-5 col-sm-5 col-xs-12">
                            @Html.TextBoxFor(x => x.activityFormModel.actIO, new { @class = "form-control textboxcss", id = "txtActIO", autocomplete = "off" })
                        </div>
                        <label class="control-label col-md-2 col-sm-2 col-xs-12">
                            Claim
                        </label>
                        <div class="col-md-3 col-sm-3 col-xs-12">
                            @Html.TextBoxFor(x => x.activityFormModel.actClaim, new { @class = "form-control textboxcss", id = "txtActClaim", @type = "number", autocomplete = "off" })
                        </div>
                        <label class="control-label col-md-1 col-sm-1 col-xs-12">
                            %
                        </label>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-xs-12">
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtdateDoc">
                        เวลากิจกรรม (Activity Period)<span class="required">*</span>
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            @Html.TextBox("activityFormModel.activityPeriodSt", DocumentsAppCode.convertDateTHToShowCultureDateEN(Model.activityFormModel.activityPeriodSt, ConfigurationManager.AppSettings["formatDateUse"]), new { @class = "form-control textboxcss", id = "txtdateActivitySt", autocomplete = "off" })
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            @Html.TextBox("activityFormModel.activityPeriodEnd", DocumentsAppCode.convertDateTHToShowCultureDateEN(Model.activityFormModel.activityPeriodEnd, ConfigurationManager.AppSettings["formatDateUse"]), new { @class = "form-control textboxcss", id = "txtdateActivityEnd", autocomplete = "off" })
                        </div>
                    </div>
                </div>
                <div class="row">
                    <label class="control-label col-md-3 col-sm-3 col-xs-12" for="txtdateDoc">
                        เวลาการให้ทุนพิเศษ (Cost Period)
                    </label>
                    <div class="col-md-9 col-sm-9 col-xs-12">
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            @Html.TextBox("activityFormModel.costPeriodSt", DocumentsAppCode.convertDateTHToShowCultureDateEN(Model.activityFormModel.costPeriodSt, ConfigurationManager.AppSettings["formatDateUse"]), new { @class = "form-control textboxcss", id = "txtdateCostPerSt", autocomplete = "off" })
                        </div>
                        <div class="col-md-6 col-sm-6 col-xs-12">
                            @Html.TextBox("activityFormModel.costPeriodEnd", DocumentsAppCode.convertDateTHToShowCultureDateEN(Model.activityFormModel.costPeriodEnd, ConfigurationManager.AppSettings["formatDateUse"]), new { @class = "form-control textboxcss", id = "txtdateCostPerEnd", autocomplete = "off" })
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<hr />
<div class="row">
    <div class="col-12">
        <p class="lead">รายละเอียดของการทำกิจกรรม (Activity Detail)</p>
    </div>
    <div class="col-md-6">
        @Html.TextAreaFor(x => x.activityFormModel.activityDetail, 6, 50, new { @class = "form-control textboxcss", @Styles = "font-size: 8pt", @id = "txtActivityDetail" })
    </div>
</div>
<hr />
<div id="getQuery" class="col-lg-12">
    @Html.Action("productCostDetail", "ActivityProductDetail", new { typeForm = Model.activityFormModel.typeForm, actId = Model.activityFormModel.id })
</div>

<div class="row" id="divAddProductCostDetail">
    <div class="col-lg-2 col-xs-2">
    </div>
    <div class="col-lg-2 col-xs-2">
    </div>

    <div class="form-group col-lg-2 col-xs-2">
        รสชาติ
        @Html.DropDownListFor(model => model.productSmellLists, new SelectList(Model.productSmellLists, "id", "nameTH"), "- เลือกรสชาติ -", new { @class = "form-control", required = "required", id = "ddlProductSmell" })
    </div>
    <div class="form-group col-lg-2 col-xs-2">
        ขนาด
        @Html.DropDownListFor(model => model.productlist, new SelectList(Model.productlist, "productCode", "size"), "- เลือกขนาด -", new { @class = "form-control", required = "required", id = "ddlProductSize" })
    </div>
    <div class="form-group col-lg-3 col-xs-3">
        สินค้า
        @Html.DropDownListFor(model => model.productlist, new SelectList(Model.productlist, "productCode", "productName"), "- เลือกสินค้า -", new { @class = "form-control", required = "required", id = "ddlProductfilter" })
    </div>
    <div class="form-group col-lg-1 col-xs-1" onclick="Additem()">
        <label class="btn ink-reaction btn-danger fa fa-plus" style="margin-top:20px;"></label>
    </div>
</div>
<hr />
<div id="divgetdetailcost" class="col-lg-12">
    @Html.Action("activityCostDetail", "ActivityCostDetail", new { typeForm = Model.activityFormModel.typeForm, actId = Model.activityFormModel.id })
</div>


<div class="row" id="divAddActivityDetail">
    <div class="form-group col-lg-8 col-xs-8">
    </div>
    <div class="form-group col-lg-3 col-xs-3">
        <select id="ddlThemeDetail" name="ddlThemeDetail" class="form-control selectpicker" data-container="body" data-live-search="true" data-hide-disabled="true">
            <option style="color:#0e0d0d;" value="0">Please Select</option>
            @foreach (var list in Model.activityGroupList)
            {
                <option style="color:#0e0d0d;" value="@list.id">@list.activitySales</option>
            }
        </select>
    </div>
    <div class="form-group col-lg-1 col-xs-1" onclick="AddThemeCost()">
        <label class="btn ink-reaction btn-danger fa fa-plus"></label>
    </div>
</div>
<hr />

<div class="modal fade" id="previewModal" role="dialog" style="display:none">
    <div id="divPreview">
    </div>
</div>

<div class="row" id="divUploadImg">
    <div class="col-12">
        <p class="lead">อัพโหลด รูปภาพ</p>
    </div>
    <div class="col-md-6" id="divUploadFiles">
        <form action="@Url.Action("uploadFilesImage", "Activity", new { actId = Model.activityFormModel.id })" class="dropzone" id="dropzoneJsForm" method="post" enctype="multipart/form-data" style="min-height: 0; padding: 5px;">
            <div class="dz-message">
                <span class="text-xl text-default-light"><i class="md md-attach-file"></i>&nbsp;Drop files here or click to upload.</span>
            </div>
        </form>
    </div>
    <div class="col-md-12">
        <div id="divgetimage" class="col-md-12">
            @Html.Action("ImageList", "Activity", new { activityId = Model.activityFormModel.id })
        </div>
    </div>
</div>
<hr />

<div class="row">
    <div id="outer">
        <div class="container">
            <div class="row">


                @if (mode != "")
                {
                    <div style="display: inline-block" id="divSaveAs">
                        <button id="btnSaveAs" type="button" class="btn ink-reaction btn-info" onclick="copyAndSaveNew()">&nbsp;Save As</button>
                    </div>
                }

                <div style="display:inline-block">
                    @if (Model.activityFormModel.typeForm == Activity_Model.activityType.OMT.ToString())
                    {
                        <a href="@Url.Action("index", "Home", new { typeForm = Activity_Model.activityType.OMT.ToString() }, null)" class="btn btn-warning"><i class="fa fa fa-reply fa-fw"></i>&nbsp;Cancel</a>
                    }
                    else
                    {
                        <a href="@Url.Action("index", "Home", new { typeForm = Activity_Model.activityType.MT.ToString() }, null)" class="btn btn-warning"><i class="fa fa fa-reply fa-fw"></i>&nbsp;Cancel</a>
                    }
                </div>

                <div style="display:inline-block; text-align:center" id="divSubmit">
                    <button id="btnsubmit" type="button" class="btn ink-reaction btn-success" onclick="validatesubmit()">&nbsp;Save Draft</button>
                </div>
                <div style="display:inline-block; text-align:center" id="divUpdate">
                    <button id="btnUpdate" type="button" class="btn ink-reaction btn-default" onclick="validateUpdate()">&nbsp;Update</button>
                </div>

            </div>
        </div>


    </div>

</div>

<input type="hidden" id="hdcusname">
@Html.HiddenFor(x => x.activityFormModel.id, new { @id = "hdActivityId" })
@Html.HiddenFor(x => x.activityFormModel.mode, new { @id = "hdMode" })
@Html.HiddenFor(x => x.activityFormModel.createdByUserId, new { @id = "hdcreateUser" })

<script type="text/javascript">


    $(document).ready(function () {
        $(".fv").each(function () {
            var v = $(this).val();
            if (v == '') {
                $(this).focus();
            }
        });

        fillProductOnChange();
        checkBtn();
        onchangeActivity();
        document.getElementById("ddlProductfilter").disabled = true;
        document.getElementById("ddlProductSize").disabled = true;
        getFormatCus();
        $("#divSubmit").hide();
        $("#divUpdate").hide();



        var chkClaim = '@ViewBag.chkClaim'
        if (chkClaim == 'True') {
            document.getElementById("divIO").style.display = "block";
        }
        else {
            document.getElementById("divIO").style.display = "none";
        }

        if (@Model.activityFormModel.statusId == "1" && '@Model.activityFormModel.createdByUserId' == '@UtilsAppCode.Session.User.empId'
            || '@string.IsNullOrEmpty(Model.activityFormModel.createdByUserId)' == 'True') {
            $("#divSubmit").show();
        }

        if ('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.OMT.ToString()') {
            $("#txtCustomerName").show();
            $("#divRegion").show();
            $("#ddlCustomer").hide();
        }
        else {
            $("#txtCustomerName").hide();
            $("#divRegion").hide();
            $("#ddlCustomer").show();
        }

        if (@Model.activityFormModel.statusId == "2" || @Model.activityFormModel.statusId == "3") {
            $("#divUpdate").show();
        }
        else {
            $("#divUpdate").hide();
        }


        if (@Model.activityFormModel.statusId != "1" || @Model.activityFormModel.statusId == "5" || '@Model.activityFormModel.createdByUserId' != '@UtilsAppCode.Session.User.empId') {
            setTxtReadOnly();
        }


        if (!'@Model.activityFormModel.createdByUserId' || '@UtilsAppCode.Session.User.isAdmin' == 'True'
            || '@UtilsAppCode.Session.User.isSuperAdmin' == 'True') {
            setTxtUnReadOnly();
        }




        $("#txtCustomerName").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("getCustomerByRegion", "eAct")',
                    type: "POST",
                    dataType: "json",
                    data: {
                        regionId: $("#ddlRegion").val(),
                        txtCus: $("#txtCustomerName").val(),
                    },
                    success: function (data) {
                        response($.map(data, function (item) {
                            return { label: item.cusNameTH, value: item.cusNameTH, id: item.id };
                        }))

                    }
                })
            },
            minLength: 0,
            messages: {
                noResults: '',
                results: function (resultsCount) {
                }
            }, select: function (event, ui) {
                $("#customerId").val(ui.item.id)
            }
        }).focus(function () {
            $(this).data("uiAutocomplete").search($(this).val());
        });
    });



    function checkBtn() {
         $.ajax({
            type: 'POST',
            url:  '@Url.Action("checkApproveRefNo", "Activity")',
             data: {
                 activityId: '@Model.activityFormModel.id',
                 typeForm:'@Model.activityFormModel.typeForm',
            }
         }).done(function (response) {
             console.log(response);
             if (response.Success == true) {
                 if ('@Model.activityFormModel.statusId' == "5") {
                     $("#divSubmit").show();
                     $("#divSaveAs").hide();
                 }
             }
        });
    }

    function OnChangeChkIO(element) {
        if (element.checked) {
            document.getElementById("divIO").style.display = "block";
        }
        else {
            document.getElementById("divIO").style.display = "none";
        }
    }

    $(function () {
        //$("#txtdateDoc").datepicker({
        //    format: 'dd-mm-yyyy'
        //});
        $("#txtdateActivitySt").datepicker({
           format: '@ConfigurationManager.AppSettings["formatDateUseJquery"]'
        });
        $("#txtdateActivityEnd").datepicker({
            format: '@ConfigurationManager.AppSettings["formatDateUseJquery"]'
        });
        $("#txtdateCostPerSt").datepicker({
           format: '@ConfigurationManager.AppSettings["formatDateUseJquery"]'
        });
        $("#txtdateCostPerEnd").datepicker({
            format: '@ConfigurationManager.AppSettings["formatDateUseJquery"]'
        });

    });


    $("#ddlProductSize").change(function () {
        var ddlProduct = $("#ddlProductfilter");
        $.ajax({
            url: '@Url.Action("getddlProduct", "eAct")',
            data: {
                brandId: $("#ddlProductBrand").val(),
                size: $("#ddlProductSize").val(),
                smellId: $("#ddlProductSmell").val(),
                productGroupId: $("#ddlProductGrp").val()
            },
            dataType: "json",
            type: 'POST',
            success: function (response) {
                if (response.Data.getProductname.length > 0) {
                    $("#ddlProductfilter option[value !='']").remove();
                    $.each(response.Data.getProductname, function () {
                        ddlProduct.append($("<option></option>").val(this['Value']).html(this['Text']));
                    });
                    document.getElementById("ddlProductfilter").disabled = false;
                }
                else {
                    document.getElementById("ddlProductfilter").disabled = true;
                }
            }
        });
    });

    function setZero(txtId) {
        if ($(txtId).val() == "0.00")
            $(txtId).val("");
    }

    function onchangeCustomer() {
        getFormatCus();

    }

    //function clearFormatCus() {
    //    $("#txtReference").val('');
    //    $('input[name="formatCus"]').each(function () {
    //        this.checked = false;
    //    });
    //}

    function getFormatCus() {
        document.getElementById("divRadioRef").innerHTML = "";
        document.getElementById("txtReference").readOnly = true;

        if ($("#ddlCustomer").val() == "@ConfigurationManager.AppSettings["cusBigC"]") {
            $("#divRadioRef").append('<input type="checkbox" id="chkHyper" name="formatCus" value="Hyper" onchange = "onchangeRdbRef(this);">Hyper</input>&nbsp;&nbsp;');
            $("#divRadioRef").append('<input type="checkbox" id="chkMarket" name="formatCus" value="Market" onchange = "onchangeRdbRef(this);">Market</input>&nbsp;&nbsp;');
            $("#divRadioRef").append('<input type="checkbox" id="chkMini" name="formatCus" value="Mini" onchange = "onchangeRdbRef(this);">Mini</input>&nbsp;&nbsp;');
            $("#divRadioRef").append('<input type="checkbox" id="chkDepot" name="formatCus" value="Depot" onchange = "onchangeRdbRef(this);">Depot</input>&nbsp;&nbsp;');
            $("#divRadioRef").append('<input type="checkbox" id="chkDonjai" name="formatCus" value="Donjai" onchange = "onchangeRdbRef(this);">Donjai</input>');
            $("#divRadioRef").append('&nbsp;&nbsp;&nbsp;&nbsp;');
        }
        else if ($("#ddlCustomer").val() == "@ConfigurationManager.AppSettings["cusLotus"]") {
            $("#divRadioRef").append('<input type="checkbox" id="chkGoFresh" name="formatCus" value="GoFresh" onchange = "onchangeRdbRef(this);">GoFresh</input>&nbsp;&nbsp;');
            $("#divRadioRef").append('<input type="checkbox" id="chkExpress" name="formatCus" value="Express" onchange = "onchangeRdbRef(this);">Express</input>&nbsp;&nbsp;');
            $("#divRadioRef").append('<input type="checkbox" id="chkTalad" name="formatCus" value="Talad" onchange = "onchangeRdbRef(this);">Talad</input>&nbsp;&nbsp;');
            $("#divRadioRef").append('<input type="checkbox" id="chkHyper" name="formatCus" value="Hyper" onchange = "onchangeRdbRef(this);">Hyper</input>');
            $("#divRadioRef").append('&nbsp;&nbsp;&nbsp;&nbsp;');
        }
        else {
            document.getElementById("txtReference").readOnly = false;
        }

        var cus = ["Hyper", "Market", "Mini", "Depot", "Donjai", "Express", "Talad","GoFresh"];
        cus.forEach(chkTrueRef);
    }

    function chkTrueRef(item, index) {
        var txtRef = document.getElementById("txtReference").value.includes(item);
        console.log(txtRef);
        if (txtRef == true) {
            document.getElementById("chk"+item).checked = true;
        }
    }

    function onchangeRdbRef(element) {

        var unionStr = $("#txtReference").val();
        unionStr += element.value + ',';

        if (!element.checked) {
            console.log(element.value + ',')
            unionStr = document.getElementById("txtReference").value.replace(element.value + ',', '');
        }

        $("#txtReference").val(unionStr)
    }

    $("#ddlProductBrand").change(function () {
        fillProductOnChange();
    });

    $("#ddlProductSmell").change(function () {
        fillProductOnChange();
    });

    function fillProductOnChange() {
        $.ajax({
            url: '@Url.Action("getProductDetail", "eAct")',
            data: {
                brandId: $("#ddlProductBrand").val(),
                smellId: $("#ddlProductSmell").val(),
                productGroupId:$("#ddlProductGrp").val()
            },
            dataType: "json",
            type: 'POST',
            success: function (response) {
                fillDataSizeAndProduct(response);
            }
        });
    }

    function fillDataSizeAndProduct(response) {
        var ddlProduct = $("#ddlProductfilter");
        var ddlSize = $("#ddlProductSize");
        if (response.Data.getProductsize.length > 0) {
            $("#ddlProductSize option[value !='']").remove();
            $.each(response.Data.getProductsize, function () {
                ddlSize.append($("<option></option>").val(this['size']).html(this['size']));
            });
            document.getElementById("ddlProductSize").disabled = false;
        }
        else {
            document.getElementById("ddlProductSize").disabled = true;
        }

        if (response.Data.getProductname.length > 0) {
            $("#ddlProductfilter option[value !='']").remove();
            $.each(response.Data.getProductname, function () {
                ddlProduct.append($("<option></option>").val(this['Value']).html(this['Text']));
            });
            document.getElementById("ddlProductfilter").disabled = false;
        }
        else {
            document.getElementById("ddlProductfilter").disabled = true;
        }
    }



    function onchangeCate() {

        $("#ddlProductBrand").val('');
        $("#ddlProductfilter").val('');
        $("#ddlProductSize").val('');
        $("#ddlProductSmell").val('');

        document.getElementById("ddlProductBrand").disabled = true;
        document.getElementById("ddlProductfilter").disabled = true;
        document.getElementById("ddlProductSize").disabled = true;

        var ddlProductGrp = $("#ddlProductGrp");

         $.ajax({
                url: '@Url.Action("getProductGroup", "eAct")',
                data: {
                    cateId: $("#ddlProductCate").val(),
                },
                dataType: "json",
                type: 'POST',
             success: function (response) {

                 if (response.Data.productGroup.length > 0) {
                     $("#ddlProductGrp option[value !='']").remove();
                     $.each(response.Data.productGroup, function () {
                         ddlProductGrp.append($("<option></option>").val(this['id']).html(this['groupName']));
                     });
                     document.getElementById("ddlProductGrp").disabled = false;
                 }
                 else {
                     document.getElementById("ddlProductGrp").disabled = true;
                 }


                }
         });
    }

    function onchangeActivity() {
        if ($("#ddlTheme option:selected").text() == 'FOC') {

            document.getElementById("divSubAct").style.display = "block";
        }
        else {

            $("#ddlSubActivity").val('')
            document.getElementById("divSubAct").style.display = "none";
        }
    }

    //$("#ddlTheme").change(function () {

    //     console.log($("#ddlTheme").val());
    //    if ($("#ddlTheme").val() == '8B5402F5-63D0-46E5-BFDA-9FC72F3CF565') {

    //        document.getElementById("divSubAct").style.display = "block";
    //    }
    //    else {

    //        $("#ddlSubActivity").val('')
    //        document.getElementById("divSubAct").style.display = "none";
    //    }
    //});

    $("#ddlProductGrp").change(function () {
        var ddlProductBrand = $("#ddlProductBrand");

        $("#ddlProductSmell").val('')
        $("#ddlProductfilter").val('');
        $("#ddlProductSize").val('');
        document.getElementById("ddlProductfilter").disabled = true;
        document.getElementById("ddlProductSize").disabled = true;

        $.ajax({
            url: '@Url.Action("getProductBrand", "eAct")',
            data: {
                p_groupId: $("#ddlProductGrp").val(),
            },
            dataType: "json",
            type: 'POST',
            success: function (response) {
                if (response.Data.getProductname.length > 0) {
                    $("#ddlProductBrand option[value !='']").remove();
                    $.each(response.Data.getProductname, function () {
                        ddlProductBrand.append($("<option></option>").val(this['Value']).html(this['Text']));
                    });
                    document.getElementById("ddlProductBrand").disabled = false;
                }
                else {
                    document.getElementById("ddlProductBrand").disabled = true;
                }
            }
        });

         $.ajax({
            url: '@Url.Action("getProductSmell", "eAct")',
            data: {
                productGroupId: $("#ddlProductGrp").val(),
            },
            dataType: "json",
            type: 'POST',
             success: function (response) {
                 if (response.Data.length > 0) {
                     $("#ddlProductSmell option[value !='']").remove();
                    $.each(response.Data, function () {
                        $("#ddlProductSmell").append($("<option></option>").val(this['id']).html(this['nameTH']));
                    });
                    document.getElementById("ddlProductSmell").disabled = false;
                }
                else {
                    document.getElementById("ddlProductSmell").disabled = true;
                }
            }
        });

    });


    function Additem() {

        var required = "กรุณา ระบุ :<br>";
        var validate = true;
        if ($("#ddlTheme").val() == '') { required += "ประเภทกิจกรรม*<br>"; validate = false; }
        if (validate != true) {
            bootbox.alert(required);
            return false;
        }

        var customer = "";
        if ('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.OMT.ToString()') {
            customer = "OMT";
        }
        else {
            customer = $("#ddlCustomer").val();
        }

        $("#WaitDialog").show();
         $.ajax({
                url: '@Url.Action("addItemProduct", "ActivityProductDetail")',
             data: {
             productid: $("#ddlProductfilter").val(),
                 brandid: $("#ddlProductBrand").val(),
                 smellId: $("#ddlProductSmell").val(),
                 size: $("#ddlProductSize").val(),
                 cusid: customer,
                 theme: $("#ddlTheme").val(),
                 actId: '@Model.activityFormModel.id',
                 typeForm: '@Model.activityFormModel.typeForm',
                 dateActivitySt: $("#txtdateActivitySt").val(),
             },
                dataType: "json",
                type: 'POST',
             success: function (response) {
                 if (response.Data > 0) {

                     rowCount = response.Data;
                     CallChangefunc(response.ActivityId);
                     callThemedetailcost(response.ActivityId);
                 }
                 else {
                     bootbox.alert("ไม่พบ สินค้า!");
                 }
                 $("#WaitDialog").hide();
             }
         });
    }

    function AddThemeCost() {
        var validate = true;
        var required = "กรุณา ระบุ :<br>";
        var ddlTheme = document.getElementById("ddlThemeDetail");
        var txtddlTheme = ddlTheme.options[ddlTheme.selectedIndex].text;
        if (txtddlTheme == 'Please Select') { bootbox.alert("กรุณา ระบุ ประเภทกิจกรรม"); validate = false; }
        if ($("#ddlProductBrand").val() == '') { required += "กรุณา Brand*<br>"; validate = false; }

        if (validate != true) {
            bootbox.alert(required);
            return false;
        }

        $("#WaitDialog").show();
         $.ajax({
            type: 'POST',
            url:  '@Url.Action("addCostDetailTheme", "ActivityCostDetail")',
             data: {
                 themeId: $("#ddlThemeDetail").val(),
                 txttheme: txtddlTheme,
                 actId: '@Model.activityFormModel.id',
                 brandId: $("#ddlProductBrand").val(),
            }
         }).done(function (response) {
             callThemedetailcost('@Model.activityFormModel.id');
             $("#WaitDialog").hide();
        });
    }



    function validatesubmit() {
        var required = "กรุณา ระบุ :<br>";
        var validate = true;
        console.log($("#txtActIO").val());

        if('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.OMT.ToString()')
        {
             if ($("#ddlRegion").val() == "") { required += "Region*<br>"; validate = false; }
             if ($("#customerId").val() == "" || $("#txtCustomerName").val() == "") { required += "Customer Name*<br>"; validate = false; }
        }
        if ($("input[name='activityFormModel.chkAddIO']:checked").val() == 'true' && $("#txtActIO").val() == "") { required += "IO*<br>"; validate = false; }
        if ($("#txtdateDoc").val() == "") { required += "Document Date*<br>"; validate = false; }
        if ($("#txtActivityName").val() == "") { required += "ชื่อกิจกรรม*<br>"; validate = false; }
        if ($("#ddlTheme").val() == "") { required += "ประเภทกิจกรรม*<br>"; validate = false; }
        if ($("#ddlTheme option:selected").text() == 'FOC' && $("#ddlSubActivity").val() == "") { required += "เพื่อกิจกรรม*<br>"; validate = false; }
        if ($("#txtObjective").val() == "") { required += "วัตถุประสงค์*<br>"; validate = false; }
        if ($("#ddlProductCate").val() == "") { required += "Product category*<br>"; validate = false; }
        if ($("#ddlProductGrp").val() == "") { required += "กลุ่มสินค้า *<br>"; validate = false; }
        if ($("#ddlProductBrand").val() == "") { required += "Brand *<br>"; validate = false; }
        if ($("#txtdateActivitySt").val() == "" || $("#txtdateActivityEnd").val() == "") { required += "เลือก เวลากิจกรรม  *<br>"; validate = false; document.getElementById("txtdateActivityEnd").focus();}
        else {
            var startDate =  $("#txtdateActivitySt").val().split("/");
            var endDate = $("#txtdateActivityEnd").val().split("/");
            if (new Date(startDate[2], startDate[1], startDate[0]) > new Date(endDate[2], endDate[1],endDate[0])) {
                required += "เลือก เวลากิจกรรมให้ถูกต้อง  *<br>"; validate = false;
            }
        }
        if ($("input[name='activityFormModel.trade']:checked").val() == null) { required += "รายการส่งเสริม *<br>"; validate = false; }


           if ($("#txtReference").val() == "" && ($("#ddlCustomer").val() == "@ConfigurationManager.AppSettings["cusBigC"]" ||
            $("#ddlCustomer").val() == "@ConfigurationManager.AppSettings["cusLotus"]")) { required += "Reference*<br>"; validate = false; }
        
        if ($("#ddlTheme option:selected").text() == 'FOC') {
            var rowCount = parseInt($('#tbl_activityDetail tr.tagTR').length);
            for (i = 0; i < rowCount; i++) {
                if ($("#lblTotalCase_" + i).val() == 0 || $("#lblTotalCase_" + i).val() == "") { required += "&emsp; ระบุราคา Spending Exp.(Case) แถวที่ " + (i + 1) + "*<br>"; validate = false; }
            }
        }

        //if (rowCount == 0) { required += "เพิ่มสินค้า *<br>"; validate = false; }

        if (validate == true) {
            SubmitData();
        }
        else {
            bootbox.alert(required)
        }
    }

    function SubmitData() {
        $("#WaitDialog").show();

        var cusId = '';
        if ('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.MT.ToString()')
        {
          cusId = $("#ddlCustomer").val()
        }
        else if('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.OMT.ToString()')
        {
             cusId = $("#customerId").val()
        }


            $.ajax({
                url: '@Url.Action("insertDataActivity", "Activity")',
                data: {
                    statusId: 1,
                    Mode: $("#hdMode").val(),
                    dateDoc: $("#txtdateDoc").val(),
                    str_costPeriodSt: $("#txtdateCostPerSt").val(),
                    str_costPeriodEnd: $("#txtdateCostPerEnd").val(),
                    str_activityPeriodSt: $("#txtdateActivitySt").val(),
                    str_activityPeriodEnd: $("#txtdateActivityEnd").val(),
                    dateProductlist: $("#txtdateActivitySt").val(),
                    dateActivitylist: $("#txtdateActivityEnd").val(),
                    Reference: $("#txtReference").val(),
                    ReferenceActNo: $("#hdReferenceActNo").val(),
                    CustomerId: cusId,
                    ProductCateId: $("#ddlProductCate").val(),
                    ProductGroupId: $("#ddlProductGrp").val(),
                    productBrandId: $("#ddlProductBrand").val(),
                    ActivityPeriodST: $("#txtdateActivitySt").val(),
                    ActivityPeriodEnd: $("#txtdateActivityEnd").val(),
                    CostPeriodST: $("#txtdateCostPerSt").val(),
                    CostPeriodEnd: $("#txtdateCostPerEnd").val(),
                    ActivityName: $("#txtActivityName").val(),
                    Theme: $("#ddlTheme").val(),
                    Objective: $("#txtObjective").val(),
                    Trade: $("input[name='activityFormModel.trade']:checked").val(),
                    ActivityDetail: $("#txtActivityDetail").val(),
                    activityNo: $("#txtActivityNo").val(),
                    createdByUserId: $("#hdcreateUser").val(),
                    id: '@Model.activityFormModel.id',
                    chkAddIO: $("input[name='activityFormModel.chkAddIO']:checked").val(),
                    actIO: $("#txtActIO").val(),
                    actClaim: $("#txtActClaim").val(),
                    typeForm: '@Model.activityFormModel.typeForm',
                    subActivity: $("#ddlSubActivity").val(),
                },
                dataType: "json",
                type: 'POST',
            }).done(function (response) {
                if (response.Success) {
                    if (response.MessageCode == "001") {
                        bootbox.alert("กรุณาทำรายการใหม่ เอกสารฉบับนี้ ส่งอนุมัติ ไปแล้ว");
                    }
                    else {
                        callPreviewData('@Model.activityFormModel.id');

                    }

                }
            });
    }




    function validateUpdate() {
        var required = "กรุณา ระบุ :<br>";
        var validate = true;

        if ($("#txtdateActivitySt").val() == "" && $("#txtdateActivityEnd").val() == "") { required += "เลือก เวลากิจกรรม  *<br>"; validate = false; }
        else {
            var startDate = $("#txtdateActivitySt").val().split("-");
            var endDate = $("#txtdateActivityEnd").val().split("-");
            if (new Date(startDate[2], startDate[1], startDate[0]) > new Date(endDate[2], endDate[1], endDate[0])) {
                required += "เลือก เวลากิจกรรมให้ถูกต้อง  *<br>"; validate = false;
            }
        }
        if (validate == true) {
            updateData();
        }
        else {
            bootbox.alert(required)
        }
    }

    function updateData() {
        $("#WaitDialog").show();
            $.ajax({
                url: '@Url.Action("updateDataActivity", "Activity")',
                data: {
                    str_costPeriodSt: $("#txtdateCostPerSt").val(),
                    str_costPeriodEnd: $("#txtdateCostPerEnd").val(),
                    str_activityPeriodSt: $("#txtdateActivitySt").val(),
                    str_activityPeriodEnd: $("#txtdateActivityEnd").val(),
                    chkAddIO: $("input[name='activityFormModel.chkAddIO']:checked").val(),
                    actIO: $("#txtActIO").val(),
                    actClaim: $("#txtActClaim").val(),
                    id:'@Model.activityFormModel.id',
                },
                dataType: "json",
                type: 'POST',
            }).done(function (response) {
                if (response.Success) {
                    $("#WaitDialog").hide();
                    doMsgSuccess("Update Success");
                }
            });
    }

    function copyAndSaveNew() {

        var cusId = '';
        if ('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.MT.ToString()')
        {
         cusId = $("#ddlCustomer").val()
        }
        else if ('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.OMT.ToString()')
        {
         cusId = $("#customerId").val()
        }

        if ('@Model.activityFormModel.statusId' == "5") {
            $("#hdReferenceActNo").val($("#txtActivityNo").val());
        }
        else {
            $("#hdReferenceActNo").val('');
        }



        bootbox.confirm({
            message: "<p class='lead text-center'>คุณต้องการ copy เอกสารเพื่อไปสร้างเอกสารใหม่ใช่หรือไม่ <br/> ยืนยัน บันทึกข้อมูล!<p>",
            buttons: {
                confirm: {
                    label: 'Yes',
                    className: 'btn-success'
                },
                cancel: {
                    label: 'No',
                    className: 'btn-danger'
                }
            },
            callback: function (result) {
                if (result == true) {
                    $("#WaitDialog").show();
                    $.ajax({
                        url: '@Url.Action("copyAndSaveNewActivityForm", "Activity")',
                        data: {
                            statusId: 1,
                            Mode: $("#hdMode").val(),
                            dateDoc: $("#txtdateDoc").val(),
                            str_costPeriodSt: $("#txtdateCostPerSt").val(),
                            str_costPeriodEnd: $("#txtdateCostPerEnd").val(),
                            str_activityPeriodSt: $("#txtdateActivitySt").val(),
                            str_activityPeriodEnd: $("#txtdateActivityEnd").val(),
                            dateProductlist: $("#txtdateActivitySt").val(),
                            dateActivitylist: $("#txtdateActivityEnd").val(),
                            Reference: $("#txtReference").val(),
                            referenceActNo: $("#hdReferenceActNo").val(),
                            CustomerId: cusId,
                            ProductCateId: $("#ddlProductCate").val(),
                            ProductGroupId: $("#ddlProductGrp").val(),
                            productBrandId: $("#ddlProductBrand").val(),
                            ActivityPeriodST: $("#txtdateActivitySt").val(),
                            ActivityPeriodEnd: $("#txtdateActivityEnd").val(),
                            CostPeriodST: $("#txtdateCostPerSt").val(),
                            CostPeriodEnd: $("#txtdateCostPerEnd").val(),
                            ActivityName: $("#txtActivityName").val(),
                            Theme: $("#ddlTheme").val(),
                            Objective: $("#txtObjective").val(),
                            Trade: $("input[name='activityFormModel.trade']:checked").val(),
                            ActivityDetail: $("#txtActivityDetail").val(),
                            regionId: $("#ddlRegion").val(),
                            activityNo: $("#txtActivityNo").val(),
                            activityNoRef: $("#txtActivityNo").val(),
                            id: '@Model.activityFormModel.id',
                            chkAddIO: $("input[name='activityFormModel.chkAddIO']:checked").val(),
                            actIO: $("#txtActIO").val(),
                            actClaim: $("#txtActClaim").val(),
                            subActivity: $("#ddlSubActivity").val(),
                        },
                        dataType: "json",
                        type: 'POST',
                    }).done(function (response) {
                        $("#WaitDialog").hide();
                        if (response.Success) {
                            if ('@Model.activityFormModel.typeForm' == '@Activity_Model.activityType.MT.ToString()') {
                                var url = '@Url.Action("ActivityForm", "activity")';
                                window.location.href = url + "?ActivityId=" + response.ActivityId + "&typeForm=" + '@Activity_Model.activityType.MT.ToString()';
                            }
                            else {
                                var url = '@Url.Action("ActivityForm", "activity")';
                                window.location.href = url + "?ActivityId=" + response.ActivityId + "&typeForm=" + '@Activity_Model.activityType.OMT.ToString()';
                            }
                        } else {
                            doMsgFail(response.Message);
                        }
                    });
                }
            }
        });
    }

    function setTxtReadOnly() {

            document.getElementById("ddlProductfilter").disabled = true;
            document.getElementById("ddlProductSize").disabled = true;
            document.getElementById("txtdateDoc").disabled = true;
            document.getElementById("txtReference").disabled = true;
            document.getElementById("txtActivityNo").disabled = true;
            document.getElementById("ddlCustomer").disabled = true;
            document.getElementById("txtActivityName").disabled = true;
            document.getElementById("ddlTheme").disabled = true;
            document.getElementById("ddlProductBrand").disabled = true;
            document.getElementById("ddlProductCate").disabled = true;
            document.getElementById("txtObjective").disabled = true;
            document.getElementById("ddlProductGrp").disabled = true;
            document.getElementById("txtdateActivitySt").disabled = true;
            document.getElementById("txtdateActivityEnd").disabled = true;
            document.getElementById("txtdateCostPerSt").disabled = true;
            document.getElementById("txtdateCostPerEnd").disabled = true;
            document.getElementById("dropzoneJsForm").disabled = true;
            document.getElementById("txtActivityDetail").disabled = true;
            document.getElementById("ddlRegion").disabled = true;
            document.getElementById("txtCustomerName").disabled = true;
            document.getElementById("txtActIO").disabled = true;
            document.getElementById("txtActClaim").disabled = true;
            document.getElementById("divAddActivityDetail").style.display = "none";
            document.getElementById("divAddProductCostDetail").style.display = "none";
            $("#tbl_activityDetail").find("input,button,textarea,select").attr("disabled", "disabled");
            $("#tbl_productDetail").find("input,button,textarea,select").attr("disabled", "disabled");
            document.getElementById("divUploadFiles").style.display = "none";


            document.getElementById("rdbterm").disabled = true;
            document.getElementById("rdbOutterm").disabled = true;
            document.getElementById("btnUpdate").style.display = "none";

             var arrayOfElements = document.getElementsByClassName('divDelImg');
             var lengthOfArray = arrayOfElements.length;
             for (var i = 0; i < lengthOfArray; i++) {
                 arrayOfElements[i].style.display = 'none';
             }


        if ('@Model.activityFormModel.statusId' == '5') {
            document.getElementById("divAddActivityDetail").style.display = "block";
            document.getElementById("divAddProductCostDetail").style.display = "block";
            $("#tbl_activityDetail").find("input,button,textarea,select").attr("disabled", false);
            $("#tbl_productDetail").find("input,button,textarea,select").attr("disabled", false);
            document.getElementById("txtObjective").disabled = false;
            document.getElementById("txtdateActivitySt").disabled = false;
            document.getElementById("txtdateActivityEnd").disabled = false;
            document.getElementById("txtdateCostPerSt").disabled = false;
            document.getElementById("txtdateCostPerEnd").disabled = false;
            document.getElementById("txtActivityDetail").disabled = false;
            document.getElementById("txtActivityName").disabled = false;
            document.getElementById("txtReference").disabled = false;
            document.getElementById("txtActIO").disabled = false;
            document.getElementById("txtActClaim").disabled = false;
            document.getElementById("divUploadFiles").style.display = "block";
            var arrayOfElements = document.getElementsByClassName('divDelImg');
            var lengthOfArray = arrayOfElements.length;
            for (var i = 0; i < lengthOfArray; i++) {
                arrayOfElements[i].style.display = 'block';
            }
        }


        if ('@UtilsAppCode.Session.User.isAdmin' == 'True' || '@UtilsAppCode.Session.User.isSuperAdmin' == 'True') {
             document.getElementById("btnUpdate").style.display = "block";
             document.getElementById("txtdateActivitySt").disabled = false;
             document.getElementById("txtdateActivityEnd").disabled = false;
             document.getElementById("txtdateCostPerSt").disabled = false;
             document.getElementById("txtdateCostPerEnd").disabled = false;
        }

        if ( '@Model.activityFormModel.createdByUserId' == '@UtilsAppCode.Session.User.empId') {
             document.getElementById("btnUpdate").style.display = "block";
             document.getElementById("divIO").disabled = false;
            document.getElementById("txtActIO").disabled = false;
            document.getElementById("txtActClaim").disabled = false;
        }
    }




     function setTxtUnReadOnly() {

         document.getElementById("ddlProductfilter").disabled = false;
         document.getElementById("ddlProductSize").disabled = false;
         document.getElementById("txtdateDoc").disabled = false;
         document.getElementById("txtReference").disabled = false;
         document.getElementById("txtActivityNo").disabled = false;
         document.getElementById("ddlCustomer").disabled = false;
         document.getElementById("txtActivityName").disabled = false;
         document.getElementById("ddlTheme").disabled = false;
         document.getElementById("ddlProductBrand").disabled = false;
         document.getElementById("ddlProductCate").disabled = false;
         document.getElementById("txtObjective").disabled = false;
         document.getElementById("ddlProductGrp").disabled = false;
         document.getElementById("txtdateActivitySt").disabled = false;
         document.getElementById("txtdateActivityEnd").disabled = false;
         document.getElementById("txtdateCostPerSt").disabled = false;
         document.getElementById("txtdateCostPerEnd").disabled = false;
         document.getElementById("dropzoneJsForm").disabled = false;
         document.getElementById("txtActivityDetail").disabled = false;
         document.getElementById("ddlRegion").disabled = false;
         document.getElementById("txtCustomerName").disabled = false;
         document.getElementById("txtActIO").disabled = false;
         document.getElementById("txtActClaim").disabled = false;

         document.getElementById("divAddActivityDetail").style.display = "block";
         document.getElementById("divAddProductCostDetail").style.display = "block";
         $("#tbl_activityDetail").find("input,button,textarea,select").attr("disabled", false);
         $("#tbl_productDetail").find("input,button,textarea,select").attr("disabled", false);
         document.getElementById("divUploadFiles").style.display = "block";


         document.getElementById("rdbterm").disabled = false;
         document.getElementById("rdbOutterm").disabled = false;
         document.getElementById("btnUpdate").style.display = "block";

         var arrayOfElements = document.getElementsByClassName('divDelImg');
         var lengthOfArray = arrayOfElements.length;
         for (var i = 0; i < lengthOfArray; i++) {
             arrayOfElements[i].style.display = 'block';
         }


          document.getElementById("btnUpdate").style.display = "block";
          document.getElementById("txtdateActivitySt").disabled = false;
          document.getElementById("txtdateActivityEnd").disabled = false;
          document.getElementById("txtdateCostPerSt").disabled = false;
          document.getElementById("txtdateCostPerEnd").disabled = false;


    }


      function callPreviewData(obj) {
        $.ajax({
            type: 'POST',
            url:  '@Url.Action("PreviewData", "Activity")',
            data: {
                activityId: obj,
                typeForm:'@Model.activityFormModel.typeForm'
            }
        }).done(function (htmlResponse) {
            $("#WaitDialog").hide();
            $("#divPreview").html(htmlResponse)
            $('#previewModal').modal('show');
        });
    }


    function callThemedetailcost(actId) {
        $.ajax({
            type: 'POST',
            url:  '@Url.Action("activityCostDetail", "ActivityCostDetail")',
            data: {

                typeForm: '@Model.activityFormModel.typeForm',
                actId: actId,
            }
        }).done(function (htmlResponse) {
            $("#divgetdetailcost").html(htmlResponse)
        });
    }

    function CallChangefunc(actId) {

        $.ajax({
            type: 'POST',
            url:  '@Url.Action("ProductCostdetail", "ActivityProductDetail")',
            data: {
                typeForm: '@Model.activityFormModel.typeForm',
                actId: actId,
            }
        }).done(function (htmlResponse) {
            $("#getQuery").html(htmlResponse)
        });
    }

    function CallImageView(obj) {
        $.ajax({
            type: 'POST',
            url:  '@Url.Action("ImageList", "Activity")',
            data: { activityId: obj}
        }).done(function (htmlResponse) {
            $("#divgetimage").html(htmlResponse)
        });
    }




</script>

<script>

    var maxImageHeight = 800;
    var fileList = new Array;
    Dropzone.options.dropzoneJsForm = {
        maxFiles: 5,
        acceptedFiles: "image/jpeg,image/jpg,image/png,application/pdf,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        paramName: "file",
        maxFilesize: 10,
        //addRemoveLinks: true,
        init: function () {
            this.on("complete", function (file) {
                CallImageView($("#hdActivityId").val());
            });
        },
    };
</script>
