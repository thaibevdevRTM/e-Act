@using eActForm.Models
@model eActForm.Models.RepDetailModel.actFormRepDetails

<div class="row">

    <div class="col-md-12 col-xs-12 text-right" style="padding: 0 30px 10px 30px;">
        @using (Html.BeginForm("repReportDetailExcel", "actFormRepDetail", FormMethod.Post))
        {
            <input type="hidden" name="GridHtml" />
            <button type="submit" class="btn ink-reaction btn-success" id="btnSubmit" value="Export">
                <i class="fa fa-file-excel-o"></i>&nbsp;Export To Excel
            </button>
        }
    </div>
    <script type="text/javascript">
        $(function () {
            $("#btnSubmit").click(function () {
                $("input[name='GridHtml']").val($("#Grid").html());
            });
        });
    </script>
</div>

<div id="Grid" class="row">

    <table id="datatable" border="0" style="text-align:center;font-family:Angsana New;font-size:10pt;" class="table table-striped table-bordered dt-responsive nowrap">
        <thead>
            <tr style="background-color:#2B5D95;color:#ffffff;text-align:center;">
                <th rowspan="3">ลำดับที่</th>
                <th rowspan="3">เลขที่ Activity</th>
                <th rowspan="3" width="150px" style="text-align:center;">ชื่อลูกค้า</th>
                <th colspan="2" rowspan="2">ระยะเวลากิจกรรม</th>
                <th colspan="2" rowspan="2">ระยะเวลาให้ทุน</th>
                <th rowspan="3" style="text-align:center;">ชื่อสินค้า</th>
                <th rowspan="3">ขนาด</th>
                <th rowspan="3" style="text-align:center;">รายละเอียดกิจกรรม</th>
                <th rowspan="2">กลุ่มกิจกรรม</th>
                <th rowspan="3">Special Discount (Pro Deal)</th>
                <th rowspan="3">Compensate (CN)</th>
                <th rowspan="3">ประมาณการค่าใช้จ่าย</th>
                <th colspan="2">ประมาณการยอดขาย</th>
                <th rowspan="3">หมายเหตุ</th>
            </tr>
            <tr style="background-color:#2B5D95;color:#ffffff;text-align:center;">
                <th>ยอดขายก่อนจัดกิจกรรม</th>
                <th>ยอดขายช่วงจัดกิจกรรม</th>
            </tr>
            <tr style="background-color:#2B5D95;color:#ffffff;text-align:center;">
                <th>วันเริ่มต้น</th>
                <th>วันสิ้นสุด</th>
                <th>วันเริ่มต้น</th>
                <th>วันสิ้นสุด</th>
                <th>14 กลุ่ม</th>
                <th>กล่อง</th>
                <th>กล่อง</th>
            </tr>
        </thead>
        @{ var index = 1; string strActNo = ""; decimal? sumTotal = 0, sumNormalSale = 0, sumNormalPromotion = 0;}
        @foreach (var item in Model.actFormRepDetailLists)
        {
            <tr>
                <td>@index</td>
                @if (item.activityNo == strActNo)
                {
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                }
                else
                {
                    <td>@item.activityNo</td>
                    <td>@item.cusNameTH</td>
                    if (item.activityPeriodSt != null)
                    {
                        <td>@item.activityPeriodSt.Value.ToString("dd/MM/yyyy")</td>
                    }
                    else
                    {
                        <td></td>
                    }
                    if (item.activityPeriodEnd != null)
                    {
                        <td>@item.activityPeriodEnd.Value.ToString("dd/MM/yyyy")</td>
                    }
                    else
                    {
                        <td></td>
                    }
                    if (item.costPeriodSt != null)
                    {
                        <td>@item.costPeriodSt.Value.ToString("dd/MM/yyyy")</td>
                    }
                    else
                    {
                        <td></td>}
                    if (item.costPeriodEnd != null)
                    {
                        <td>@item.costPeriodEnd.Value.ToString("dd/MM/yyyy")</td>
                    }
                    else
                    {
                        <td></td>}
                }

                <td>@item.productName</td>
                <td>@item.size</td>
                <td>@item.activityDetail</td>
                <td>@item.typeTheme</td>
                <td>@{ var discount = (item.specialDiscBaht == 0) ? item.specialDisc : item.specialDiscBaht; } @discount</td>
                <td></td>
                <td>@string.Format("{0:n2}", item.total)</td>
                <td>@string.Format("{0:n2}", item.normalSale)</td>
                <td>@string.Format("{0:n2}", item.promotionSale)</td>

                <td></td>
            </tr>
            strActNo = item.activityNo;
            sumTotal = sumTotal + item.total;
            sumNormalSale = item.normalSale == "" ? sumNormalSale : sumNormalSale + decimal.Parse(item.normalSale);
            sumNormalPromotion = item.promotionSale == "" ? sumNormalPromotion : sumNormalPromotion + decimal.Parse(item.promotionSale);
            index++;
        }
        <tr>
            <td colspan="13" style="text-align:right;background-color:#a3d5cf"><h4>รวม : </h4></td>
            <td><h5> @string.Format("{0:n2}", sumTotal)</h5></td>
            <td><h5>@string.Format("{0:n2}", sumNormalSale)</h5></td>
            <td><h5>@string.Format("{0:n2}", sumNormalPromotion)</h5></td>
            <td></td>
        </tr>
    </table>
</div>